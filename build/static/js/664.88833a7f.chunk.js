"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[664],{65009:function(e,t,n){n.r(t);var a=n(93433),r=n(37762),s=n(74165),c=n(15861),o=n(15671),i=n(43144),l=n(60136),d=n(27277),u=n(72791),h=n(55294),p=n(11087),x=(n(88384),n(78983)),f=n(56355),g=n(16856),m=(n(18513),n(8477),n(18512)),k=(n(66338),n(80184)),b=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;(0,o.Z)(this,n);for(var a=arguments.length,i=new Array(a),l=0;l<a;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state={assets:[],filteredAssets:[],searchQuery:"",formData:{},loading:!0},e.handleMouseEnter=function(){e.setState({isHovered:!0})},e.handleMouseLeave=function(){e.setState({isHovered:!1})},e.handleClick=function(){e.setState((function(e){return{isClicked:!e.isClicked}}))},e.getAssetLocations=(0,c.Z)((0,s.Z)().mark((function t(){var n,a;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://backendmaintenx.onrender.com/locations");case 3:if((n=t.sent).ok){t.next=6;break}throw new Error("Error: ".concat(n.status," - ").concat(n.statusText));case 6:return t.next=8,n.json();case 8:0===(a=t.sent).length?console.log("No locations found."):(console.log("Asset Locations:",a),e.setState({this:a})),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error fetching asset locations:",t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[0,12]])}))),e.sendSMS=function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t,n,a,c){var o,i,l,d,u,h,p,x,f,g,m;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o="AAABRD",i="NDE1MDY2NGM2Mzc3NTI0ZjQzNmE1YTM5NDY0YzZlNzU=",l="PM SChedule",d="Check PM Schedule for more.",u=(0,r.Z)(t),e.prev=5,u.s();case 7:if((h=u.n()).done){e.next=26;break}return p=h.value,x=encodeURIComponent("Breakdown For ".concat(l," please visit concerned department Details are ").concat(d," - Aurangabad Auto Ancillary")),f="https://api.textlocal.in/send/?apikey=".concat(i,"&sender=").concat(o,"&numbers=").concat(p.phoneNumber,"&message=").concat(x),e.prev=11,e.next=14,fetch(f);case 14:return g=e.sent,e.next=17,g.json();case 17:m=e.sent,console.log("SMS sent successfully to ".concat(p.name," (").concat(p.phoneNumber,"):"),m),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(11),console.error("Error sending SMS to ".concat(p.name," (").concat(p.phoneNumber,"):"),e.t0);case 24:e.next=7;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(5),u.e(e.t1);case 31:return e.prev=31,u.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,null,[[5,28,31,34],[11,21]])})));return function(t,n,a,r){return e.apply(this,arguments)}}(),e.updateNextDate=(0,c.Z)((0,s.Z)().mark((function t(){var n,a,r,o,i,l,d,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Date,a=e.state||{},r=a.assets,o=[],i=[],r){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,Promise.all(r.map(function(){var e=(0,c.Z)((0,s.Z)().mark((function e(t){var a,r,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new Date(t.nextDate),!(n>=a)){e.next=30;break}r=t.ScheduledMaintenanceDatesandIntervals?t.ScheduledMaintenanceDatesandIntervals.toLowerCase():"daily",c=1,e.t0=r,e.next="daily"===e.t0?7:"weekly"===e.t0?9:"fifteen days"===e.t0?11:"monthly"===e.t0?13:"quarterly"===e.t0?15:"half year"===e.t0?17:"yearly"===e.t0?19:21;break;case 7:return c=1,e.abrupt("break",24);case 9:return c=8,e.abrupt("break",24);case 11:return c=7,e.abrupt("break",24);case 13:return c=34,e.abrupt("break",24);case 15:return c=104,e.abrupt("break",24);case 17:return c=208,e.abrupt("break",24);case 19:return c=47,e.abrupt("break",24);case 21:console.error("Unsupported frequency for task: ".concat(t.TaskName)),r="daily",c="";case 24:for(a.setDate(a.getDate()+c);0===a.getDay();)a.setDate(a.getDate()+1);t.nextDate!==a.toISOString().split("T")[0]&&(o.push(t._id,t.Location),i.push(t.Location)),t.nextDate=a.toISOString().split("T")[0],t.status="Pending","Completed"===t.status&&n<a&&(t.status="Pending");case 30:return e.abrupt("return",t);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:if(l=t.sent,t.prev=9,!(o.length>0)){t.next=17;break}return t.next=13,h.Z.get("https://backendmaintenx.onrender.com/api/pm",{params:{ids:o}});case 13:d=t.sent,console.log("Updated Assets Details:",d.data),t.next=18;break;case 17:console.log("No assets were updated.");case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(9),console.error("Error fetching updated assets details:",t.t0);case 23:return t.next=25,Promise.all(l);case 25:u=t.sent,e.setState({assets:u},(0,c.Z)((0,s.Z)().mark((function t(){var n,a,r,c;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,h.Z.put("https://backendmaintenx.onrender.com/api/updateRecords",{pms:u});case 3:n=t.sent,console.log("Next Date updated in the database:",n.data),console.log("Updated IDs:",o),console.log("Updated Locations:",i),a=(0,s.Z)().mark((function t(){var n,a,o,i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=c[r],t.prev=1,t.next=4,h.Z.get("http://192.168.1.3:5000/UserInfoByLocation/".concat(n));case 4:a=t.sent,o=a.data,i=o.map((function(e){return e.phoneNumber})),o.forEach((function(t){console.log("Sending SMS to user:",t.name,t.phoneNumber);var n=e.state.formData.nextDate,a=e.state.formData.ScheduledMaintenanceDatesandIntervals;e.sendSMS(o,i,n,a)})),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),console.error("Error fetching user info by location:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[1,10]])})),r=0,c=i;case 9:if(!(r<c.length)){t.next=14;break}return t.delegateYield(a(),"t0",11);case 11:r++,t.next=9;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t.catch(0),console.error("Error updating Next Date in the database:",t.t1);case 19:case"end":return t.stop()}}),t,null,[[0,16]])}))));case 27:case"end":return t.stop()}}),t,null,[[9,20]])}))),e.handleSearchChange=function(t){var n=t.target.value.toLowerCase(),a=e.state.assets.filter((function(e){return(e.TaskName||"").toLowerCase().includes(n)}));e.setState({filteredAssets:a,searchQuery:n})},e}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,c.Z)((0,s.Z)().mark((function e(){var t,n,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.fetchData(),e.next=3,this.getAssetLocations();case 3:this.updateNextDate=this.updateNextDate.bind(this),(t=new Date).setHours(2,27,0,0),n=t-new Date,setTimeout((function(){a.updateNextDate(),a.updateInterval=setInterval(a.updateNextDate,864e5)}),n),h.Z.get("https://backendmaintenx.onrender.com/api/pm").then((function(e){var t=Array.isArray(e.data)?e.data:[e.data];t=t.map((function(e){return e.status||(e.status="Pending"),e}));var n=new Date;t=t.map((function(e){var t=new Date(e.nextDate);return n>=t&&e.status,e})),a.setState({assets:t,loading:!1})})).catch((function(e){console.error("Error fetching data:",e),alert("Error fetching data"),a.setState({loading:!1})}));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){clearInterval(this.updateInterval)}},{key:"fetchData",value:function(){var e=this;h.Z.get("http://192.168.1.3:5000/UserInfo").then((function(t){e.setState(t.data),console.log(t)})).catch((function(e){console.error("Error fetching data:",e),alert("Error fetching data")}))}},{key:"deleteData",value:function(e){var t=this;window.confirm("Are you sure you want to delete this data?")&&h.Z.delete("https://backendmaintenx.onrender.com/api/pm/".concat(e)).then((function(n){console.log("Data deleted:",n.data);var r=t.state.assets.findIndex((function(t){return t._id===e}));if(-1!==r){var s=(0,a.Z)(t.state.assets);s.splice(r,1),t.setState({assets:s,message:"Data successfully deleted!"})}})).catch((function(e){console.error("Error deleting data:",e),t.setState({message:"Error deleting data. Please try again."}),setTimeout((function(){t.setState({message:""})}),2e3)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.assets,a=t.filteredAssets,r=t.message,s=t.searchQuery,c=t.loading,o=n.filter((function(e){return e.TaskName&&""!==e.TaskName.trim()})),i=this.state.isClicked;return(0,k.jsxs)("div",{className:"container",style:{marginTop:"0px"},children:[(0,k.jsx)(p.OL,{to:"/taskForm",children:(0,k.jsx)(x.u5,{className:"mb-2",style:{marginTop:"5px",backgroundColor:"#000026"},children:"Add New"})}),(0,k.jsx)("label",{htmlFor:"searchTask",style:{marginLeft:"70%"},children:(0,k.jsx)("span",{role:"img","aria-label":"search-icon"})}),(0,k.jsx)("input",{type:"text",id:"searchTask",placeholder:"Search Task",style:{marginBottom:"10px",padding:"8px",border:"1px solid ",borderRadius:"4px",transition:"border-color 0.3s ease-in-out, background-color 0.3s ease-in-out",backgroundColor:i?"#ccc":"transparent"},onClick:this.handleClick,value:this.searchQuery,onChange:this.handleSearchChange}),(0,k.jsx)("div",{className:"table-container",children:(0,k.jsxs)(m.iA,{className:"custom-table",children:[(0,k.jsx)(m.hr,{children:(0,k.jsxs)(m.Tr,{children:[(0,k.jsx)(m.Th,{style:{textAlign:"center",height:"40px"},children:"Asset Name"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Location"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Task Name"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Task Description"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Scheduled Maintenance"}),(0,k.jsx)(m.Th,{}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Start Date"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Next Date"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Status"}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Edit "}),(0,k.jsx)(m.Th,{style:{textAlign:"center"},children:"Delete"})]})}),(0,k.jsx)(m.p3,{children:c?(0,k.jsx)("tr",{children:(0,k.jsx)("td",{colSpan:"11",style:{textAlign:"center"},children:(0,k.jsx)("p",{children:"Loading..."})})}):(0,k.jsxs)(k.Fragment,{children:[r&&(0,k.jsx)("tr",{children:(0,k.jsx)("td",{colSpan:"8",style:{textAlign:"center",fontStyle:"italic",color:"red"},children:r})}),(s?a:o).map((function(t){return(0,k.jsxs)(m.Tr,{children:[(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.AssetName}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.Location}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.TaskName}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.TaskDescription}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.ScheduledMaintenanceDatesandIntervals}),(0,k.jsx)(m.Td,{}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:new Date(t.startDate).toISOString().split("T")[0]}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:new Date(t.nextDate).toISOString().split("T")[0]}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:t.status}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:(0,k.jsx)(p.OL,{to:"/editPM/".concat(t._id),style:{color:"#000080"},children:(0,k.jsx)(f.fmQ,{})})}),(0,k.jsx)(m.Td,{style:{textAlign:"center"},children:(0,k.jsx)("button",{className:"btn",onClick:function(){return e.deleteData(t._id)},style:{color:"red"},children:(0,k.jsx)(g.ZkW,{})})})]},t._id)}))]})})]})})]})}}]),n}(u.Component);t.default=b},8477:function(){},88384:function(e,t,n){e.exports=n.p+"static/media/delete.bbfa134897cae0aaf53d.png"},18513:function(e,t,n){e.exports=n.p+"static/media/loader.0b2c6b0bc99fc6df75e4.gif"}}]);
//# sourceMappingURL=664.88833a7f.chunk.js.map